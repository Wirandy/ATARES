// [1] Konfigurasi Provider Database
// Kita menggunakan PostgreSQL sesuai pilihan Anda.
datasource db {
  provider = "postgresql" 
  url      = env("DATABASE_URL")
}

// Alat untuk menghasilkan kode klien (Prisma Client)
generator client {
  provider = "prisma-client-js"
}

// Enum untuk Status Analisis, sesuai AnalysisResult.status di frontend
enum AnalysisStatus {
  PENDING    // Belum diproses atau menunggu antrian AI/Expert System
  PROCESSING // Sedang diproses oleh AI/Expert System
  COMPLETED  // Selesai, siap ditampilkan ke pengguna
  FAILED     // Gagal diproses
}

// --------------------------------------------------------------------
// [2] Model User (Tabel Pengguna)
// Digunakan untuk otentikasi (Login/Register) dan profil.
// --------------------------------------------------------------------
model User {
  id            String    @id @default(cuid()) // ID unik, otomatis dibuat oleh CUID
  name          String
  email         String    @unique               // Harus unik, digunakan sebagai username
  phoneNumber   String    @unique
  passwordHash  String    // Wajib di-hash menggunakan bcrypt
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  // Relasi: User memiliki riwayat Analisis dan Sesi Chat
  analyses      Analysis[]    
  chatSessions  ChatSession[] 
}

// --------------------------------------------------------------------
// [3] Model Analysis (Tabel Hasil Analisis Kulit)
// Menyimpan hasil dari Face Detection (AI) dan Expert System.
// --------------------------------------------------------------------
model Analysis {
  id          String   @id @default(cuid())
  userId      String   // Relasi ke user
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  imageUrl    String   // URL foto yang di-upload (simpan ke public/uploads atau Cloudinary)
  pimpleCount Int      // Jumlah jerawat terdeteksi
  confidence  Float?   // Rata-rata confidence score dari YOLOv8
  recommendations String? // Output expert system (JSON string atau text)
  timestamp   DateTime @default(now())
  notes       String?  // Catatan user (opsional)

  @@map("analyses") // Nama table di DB
}

// --------------------------------------------------------------------
// [4] Model Chat Session (Tabel Riwayat Chatbot)
// Menyimpan riwayat percakapan pengguna dengan chatbot.
// --------------------------------------------------------------------
model ChatSession {
  id            String    @id @default(cuid())
  userId        String
  user          User      @relation(fields: [userId], references: [id])
  
  messages      Json      // Array of chat messages
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}